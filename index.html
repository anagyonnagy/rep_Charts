<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi‑Asset Chart Dashboard</title>

  <!-- 1) Lightweight Charts könyvtár HELYES beillesztése -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

  <style>
    :root { --gap: 12px; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #f7f7f9;
      color: #222;
    }
    header {
      padding: 16px 20px;
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(260px, 1fr));
      gap: var(--gap);
      padding: 16px;
    }
    .chart-box {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      min-height: 260px;
    }
    .title {
      font-size: 14px;
      line-height: 1;
      color: #444;
      margin: 4px 6px 8px;
    }
    .chart {
      flex: 1;
      min-height: 220px;
    }

    /* Kis képernyőn 1 oszlop, közepes képernyőn 2 oszlop */
    @media (max-width: 1100px) {
      #grid { grid-template-columns: repeat(2, minmax(240px, 1fr)); }
    }
    @media (max-width: 700px) {
      #grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h2 style="margin:0;">Multi‑Asset Chart Dashboard (Lightweight Charts)</h2>
    <div style="font-size:13px;color:#666;margin-top:6px;">
      Példa Binance órás gyertyákkal | Csak Binance‑en létező szimbólumokat használj (pl. BTCUSDT)
    </div>
  </header>

  <main id="grid"></main>

  <script>
    // --- 2) Csak olyan szimbólumok, amelyek biztosan léteznek a Binance spot piacon ---
    const symbols = ["BTCUSDT","ETHUSDT","BNBUSDT","ADAUSDT","XRPUSDT","SOLUSDT"];

    // --- 3) Segédfüggvény: létrehoz egy chart‑kártyát a gridben ---
    function createCard(symbol) {
      const box = document.createElement("section");
      box.className = "chart-box";

      const title = document.createElement("div");
      title.className = "title";
      title.textContent = symbol + " • 1h";

      const canvas = document.createElement("div");
      canvas.className = "chart";

      box.appendChild(title);
      box.appendChild(canvas);
      document.getElementById("grid").appendChild(box);

      return { box, canvas };
    }

    // --- 4) Chart létrehozása és reszponzív mértezés ---
    function buildChart(container) {
      const chart = LightweightCharts.createChart(container, {
        layout: { background: { color: '#ffffff' }, textColor: '#222' },
        grid: { vertLines: { color: '#f0f3fa' }, horzLines: { color: '#f0f3fa' } },
        rightPriceScale: { borderVisible: false },
        timeScale: { borderVisible: false, timeVisible: true, secondsVisible: false }
      });
      const series = chart.addAreaSeries({
        lineColor: '#2962FF',
        topColor: 'rgba(41,98,255,0.4)',
        bottomColor: 'rgba(41,98,255,0.0)'
      });

      // ResizeObserver: a konténer szélessége/magassága változáskor illesztjük a chartot
      const ro = new ResizeObserver(entries => {
        for (const entry of entries) {
          const cr = entry.contentRect;
          chart.applyOptions({ width: Math.floor(cr.width), height: Math.floor(cr.height) });
        }
      });
      ro.observe(container);

      return { chart, series };
    }

    // --- 5) Adatok betöltése Binance‑ről (órás gyertyák) ---
    async function loadBinanceKlines(symbol, interval = "1h", limit = 300) {
      const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Binance API hiba ${res.status}: ${await res.text()}`);
      const rows = await res.json();
      // Klines: [openTime, open, high, low, close, volume, closeTime, ...]
      return rows.map(c => ({
        time: c[0] / 1000,        // epoch sec
        value: parseFloat(c[4])   // záróár
      }));
    }

    // --- 6) Összerakás ---
    (async function main() {
      for (const sym of symbols) {
        const { canvas } = createCard(sym);
        const { series } = buildChart(canvas);

        try {
          const data = await loadBinanceKlines(sym, "1h", 500);
          series.setData(data);
        } catch (err) {
          console.error(sym, err);
          // Hiba esetén egy placeholder vonal, hogy a kártya ne maradjon üres
          const now = Math.floor(Date.now()/1000);
          series.setData([
            { time: now - 3600*3, value: 1 },
            { time: now - 3600*2, value: 2 },
            { time: now - 3600*1, value: 1.5 },
            { time: now,           value: 2.2 }
          ]);
        }
      }
    })();
  </script>
</body>
</html>
